#!/bin/bash
# metro - A CLI app for Linux
# 
# Copyright (C) 2024 rxxuzi
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

VERSION_FILE="bin/METRO_VERSION"
STATION_DIR="$(cd "$(dirname "$0")/../station" && pwd)"

# アスキーアート
ASCII_ART="\
                _____              
_______ __________/ /_____________ 
__  __ \`__ \  _ \  __/_  ___/  __ \\
_  / / / / /  __/ /_  / /   / /_/ /
/_/ /_/ /_/\___/\__/ /_/    \____/ 
"

function show_version() {
    echo "$ASCII_ART"
    if [ -f "$VERSION_FILE" ]; then
        local version=$(cat "$VERSION_FILE")
        echo "metro version $version"
    else
        echo "Version file not found. Please ensure that 'bin/METRO_VERSION' exists."
    fi
    echo
    echo "Copyright (C) 2024 rxxuzi"
    echo "This is free software; see the source for copying conditions.  There is NO"
    echo "warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
    echo
    echo "Type 'metro help' for a list of commands."
    echo "Each command supports '-h' for more information."
}

# ヘルプメニュー
function show_help() {
    echo "metro - A CLI app for Linux"
    echo
    echo "Usage:"
    echo "  metro install           - Install the app"
    echo "  metro venv              - Setup Python virtual environment"
    echo "  metro vcc               - Vim colorscheme change"
    echo "  metro prompt            - Change prompt style"
    echo "  metro path              - Manage PATH entries"
    echo "  metro sysinfo           - Display system information"
    echo "  metro version           - Show version information"
    echo "  metro help              - Show this help message"
    echo
    echo "Each command supports '-h' for more information."
}

if [ $# -eq 0 ]; then
    show_help
    exit 0
fi

case "$1" in
    install)
        python3 "$STATION_DIR/install.py" "${@:2}"
        ;;
    venv)
        bash "$STATION_DIR/shell/venv-setup.sh" "${@:2}"
        ;;
    vcc)
        python3 "$STATION_DIR/vcc.py" "${@:2}"
        ;;
    prompt)
        bash "$STATION_DIR/shell/chprompt.sh" "${@:2}"
        ;;
    path)
        python3 "$STATION_DIR/path.py" "${@:2}"
        ;;
    sysinfo)
        bash "$STATION_DIR/shell/sysinfo.sh" "${@:2}"
        ;;
    version|--version|-v)
        show_version
        ;;
    help|--help|-h)
        show_help
        ;;
    *)
        echo "Invalid command. Type 'metro help' for a list of commands."
        exit 1
        ;;
esac
